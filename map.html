<script>

    /*const data = [{
        name : '店の名前',
        link : "https://example.com/",
        latitude : 37.508106,
        longitude : 139.93023,
        comment : "焼き鳥って言うのに、焼き牛とは言わないんだね。",
        user : "hogeman",
        release : true
    }]*/

    //マーカーのポップアップ
        //店名
        //場所
        //詳細情報のボタン

    let mapData = [];

    //地図上にマーカーを追加
    function addMarkerOnMap(data){
        let content;
        let button;
        console.log("配列",data);
        // マーカーを追加する
        for (let i = 0; i < data.length; i++) {

            //スプレッドシートの情報を配列に追加
            const tmpObj = {
                "name": data[i]["name"],
                "catch": data[i]["catch"],
                "link": data[i]["link"],
                "comment" : data[i]["comment"],
                "id" : data[i]["id"]
            };

            mapData.push(tmpObj);

            //リリースの判定をここに書く

            button = '<br><button name="button" onclick="buttonClick(\'' + data[i]["id"] + '\')">詳細情報</button>';
            //button = '<br><button name="button" onclick="buttonClick("'+data[i]["id"]+'")">詳細情報</button>';
            console.log(button);
            content = L.popup().setContent(data[i]["name"] + button);
            L.marker([data[i]["latitude"],data[i]["longitude"]]).addTo(map)
            .bindPopup(content)
            .openPopup();
            //.bindPopup(data[i]["comment"])
        }

      // 地図の中心座標とズームレベルを設定する
        map.setView([37.508106, 139.930239], 13);
        return 0;
    }

    //マーカーの情報をスプレッドシートから読み込む
    function readMapData(){
        let datatest;
        google.script.run.withSuccessHandler(
            function(datatest) {
                console.log(datatest);
                addMarkerOnMap(datatest);
            }
        ).withFailureHandler(console.log("読み込み失敗")).getDataSet()
        return 0;
    }

    // 地図を作成する
    var map = L.map('map');
    
    // タイルレイヤーを作成し、地図にセットする
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    
    readMapData();


</script>